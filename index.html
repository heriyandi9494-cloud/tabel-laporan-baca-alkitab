<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Absensi 312 Hari Mobile Friendly</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
/* ===== TABEL ===== */
.table-responsive { overflow-x: auto; -webkit-overflow-scrolling: touch; }
@media (max-width: 768px) {
  body { padding: 1rem; }
  h4, h5 { font-size: 1.2rem; }
  .table th, .table td { font-size: 0.85rem; padding: 0.3rem; }
  button { font-size: 0.8rem; padding: 0.25rem 0.5rem; }
}
input[type=checkbox] { transform: scale(1.2); margin: 0.2rem; }
button { margin-bottom: 0.2rem; }
.card { cursor:pointer; min-width:150px; }
/* Border tabel ungu lebih tebal */
.table-bordered, 
.table-bordered th, 
.table-bordered td {
  border: 2px solid purple !important; /* Ubah warna border menjadi ungu dan lebih tebal */
}

/* Optional: header lebih menonjol */
.table thead th {
  background-color: #f3e5f5; /* latar belakang ungu muda */
  color: #4a148c; /* teks ungu gelap */
  font-weight: bold;
}
/* ===== TABEL ===== */
.table-responsive { 
  overflow-x: auto; 
  -webkit-overflow-scrolling: touch; 
}

.table-bordered {
  border: 1.5px solid purple; /* garis tabel ungu elegan */
  border-radius: 6px; /* sudut sedikit melengkung */
}

.table-bordered th, 
.table-bordered td {
  border: 1.5px solid purple; /* border antar sel */
  vertical-align: middle;
  text-align: center;
  padding: 0.4rem; /* padding lebih konsisten */
}

.table thead th {
  background-color: #f3e5f5; /* ungu muda */
  color: #4a148c; /* ungu gelap */
  font-weight: bold;
}

.table-bordered tbody tr:hover {
  background-color: #fce4ec; /* highlight saat hover */
}

/* ===== CARD ===== */
.card {
  cursor: pointer;
  min-width: 160px;
  max-width: 160px; /* semua card sama ukuran */
  text-align: center;
  margin: 0.3rem;
  border: 1.5px solid #9c27b0; /* border ungu */
  border-radius: 8px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  transition: transform 0.2s, box-shadow 0.2s;
}

.card:hover {
  transform: translateY(-3px);
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
}

.card h6 {
  margin: 0.5rem 0;
  font-size: 0.95rem;
  color: #4a148c;
}

.card button {
  font-size: 0.8rem;
  padding: 0.25rem 0.5rem;
  margin-top: 0.3rem;
}

/* ===== RESPONSIVE ===== */
@media (max-width: 768px) {
  body { padding: 1rem; }
  h4, h5 { font-size: 1.2rem; }
  .table th, .table td { font-size: 0.85rem; padding: 0.3rem; }
  button { font-size: 0.75rem; padding: 0.2rem 0.4rem; }
  .card { min-width: 140px; max-width: 140px; }
}

/* ===== CHECKBOX ===== */
input[type=checkbox] { 
  transform: scale(1.2); 
  margin: 0.2rem; 
}

button { margin-bottom: 0.2rem; }

</style>
</head>
<body>
<div class="container">
<h4 class="mb-3">ğ“ğšğ›ğğ¥ ğ‹ğšğ©ğ¨ğ«ğšğ§ ğğšğœğš ğ€ğ¥ğ¤ğ¢ğ­ğšğ› ğ’ğğ¥ğšğ¦ğš ğŸ‘ğŸğŸ ğ‡ğšğ«ğ¢</h4>
<div class="table-responsive">
<table class="table table-bordered text-center">
<thead></thead>
<tbody id="tabelAbsensi"></tbody>
</table>
</div>
<hr>
<h5>ğƒğšğ­ğš ğŠğŒğ€ ğŸ‘ğŸğŸ ğ‡ğšğ«ğ¢ (ğŠğ¥ğ¢ğ¤ ğğšğ¦ğš ğ”ğ§ğ­ğ®ğ¤ ğ‹ğ¢ğ¡ğšğ­ ğ‹ğšğ©ğ¨ğ«ğšğ§ ğ©ğğ« ğ¦ğ¢ğ§ğ ğ ğ®)</h5>
<div id="listMinggu" class="d-flex flex-wrap"></div>

<!-- MODAL LAPORAN -->
<div class="modal fade" id="modalLaporan">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">ğ‹ğšğ©ğ¨ğ«ğšğ§ ğŒğ¢ğ§ğ ğ ğ®ğšğ§</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="table-responsive">
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>ğğ¨</th>
              <th>ğŒğ¢ğ§ğ ğ ğ®</th>
              <th>ğ“ğšğ§ğ ğ ğšğ¥ ğ‹ğšğ©ğ¨ğ«ğšğ§</th>
            </tr>
          </thead>
          <tbody id="isiModal"></tbody>
        </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
// ===== FIREBASE CONFIG =====
const firebaseConfig = {
  apiKey: "AIzaSyCMW7INvJsMg67GQm0GrE1BpkZAvQkhOS8",
  authDomain: "savekma312hari.firebaseapp.com",
  databaseURL: "https://savekma312hari-default-rtdb.firebaseio.com",
  projectId: "savekma312hari",
  storageBucket: "savekma312hari.firebasestorage.app",
  messagingSenderId: "167003010790",
  appId: "1:167003010790:web:bdfed5d9192c3b30cbad27"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ===== DATA =====
const fotoMap = {
  "Elisyanti": "https://i.postimg.cc/SKgfWTRW/Screenshot-1.jpg",
  "Fitry K": "https://i.postimg.cc/g076zfnb/Screenshot-2.jpg",
  "Ida Farida": "https://i.postimg.cc/NG6LSy7w/Screenshot-3.jpg",
  "Alexia": "https://i.postimg.cc/cLpSdh0b/Screenshot-4.jpg",
  "Anastasia Coyang": "https://i.postimg.cc/zXy63hd2/Screenshot-5.jpg",
  "Aprilia": "https://i.postimg.cc/SKdDgQT8/Screenshot-6.jpg",
  "Brigita Nila": "https://i.postimg.cc/Nj4zzxL1/Screenshot-7.jpg",
  "Christina Suminah": "https://i.postimg.cc/RFrK1k9Q/Screenshot-8.jpg",
  "Christine TW": "https://i.postimg.cc/5Njy0PWH/Screenshot-9.jpg",
  "Cinda": "https://i.postimg.cc/L6ZSwGMh/Screenshot-10.jpg",
  "Divi": "https://i.postimg.cc/htBGrK7S/Screenshot-11.jpg",
  "Dodi Kurniawan": "https://i.postimg.cc/j2ybwJc4/Screenshot-12.jpg",
  "Enjelika": "https://i.postimg.cc/J0LFFY3s/Screenshot-13.jpg",
  "Emiliana Landa": "https://i.postimg.cc/sgXNbhW0/Screenshot-14.jpg",
  "Fatmawati": "https://i.postimg.cc/8z9t3nNw/Screenshot-15.jpg",
  "Efremia Herlina Femi": "https://i.postimg.cc/9QRBGtZ7/Screenshot-16.jpg",
  "Audrey": "https://i.postimg.cc/kX94NnSX/Screenshot-17.jpg",
  "Haleria Biati": "https://i.postimg.cc/P57T7hC8/Screenshot-18.jpg",
  "Henda S": "https://i.postimg.cc/YSgKyFcZ/Screenshot-19.jpg",
  "Regnum": "https://i.postimg.cc/sXcLt9TK/Screenshot-20.jpg",
  "Heri": "https://i.postimg.cc/5NcPnr9Q/Screenshot-21.jpg",
  "Ignasius Andros": "https://i.postimg.cc/Bn7Hw85M/Screenshot-22.jpg",
  "Anastasia Mukat": "https://i.postimg.cc/QdzKJ2sb/Screenshot-23.jpg",
  "Belasius": "https://i.postimg.cc/fRn6SLSC/Screenshot-24.jpg",
  "Jeni Jiang": "https://i.postimg.cc/ydjLx64P/Screenshot-26.jpg",
  "Jeqlin": "https://i.postimg.cc/BQXmZGhp/Screenshot-27.jpg",
  "Jessica": "https://i.postimg.cc/YS36fXnx/Screenshot-28.jpg",
  "Lani Kumala": "https://i.postimg.cc/4xGw6h4Z/Screenshot-29.jpg",
  "Maria Aprilinda": "https://i.postimg.cc/k54QsQ0P/Screenshot-30.jpg",
  "Maria Nurtania": "https://i.postimg.cc/X7k901W2/Screenshot-31.jpg",
  "Meriandini": "https://i.postimg.cc/rsLRBxPy/Screenshot-32.jpg",
  "Merry": "https://i.postimg.cc/QtcHJVdh/Screenshot-33.jpg",
  "Nando Castanyo": "https://i.postimg.cc/Gm9tSXm9/Screenshot-34.jpg",
  "Ratri Yulianingsih": "https://i.postimg.cc/sXPgZ8wm/Screenshot-35.jpg",
  "Rina": "https://i.postimg.cc/bNwwsmb0/Screenshot-36.jpg",
  "Sr. In, ALMA": "https://i.postimg.cc/mD4bRjBV/Screenshot-37.jpg",
  "Suhadi Kusno": "https://i.postimg.cc/rpnvZ9zz/Screenshot-38.jpg",
  "Sukamoi": "https://i.postimg.cc/wTQ4bkGs/Screenshot-39.jpg",
  "Yani Irianita": "https://i.postimg.cc/ZRP6Kw34/Screenshot-41.jpg",
  "Yohana Hesti": "https://i.postimg.cc/7Zpz3Fn8/Screenshot-42.jpg",
  "Yokinson": "https://i.postimg.cc/Fsh82DJn/yokin.jpg",
  "Yosafat": "https://i.postimg.cc/1X5VRsyQ/Screenshot-43.jpg",
  "Youla Kairupan": "https://i.postimg.cc/FKyYj7Kp/Screenshot-44.jpg",
  "Yuliana Mangan": "https://i.postimg.cc/CMPzHyw6/Screenshot-45.jpg",
  "Yustina": "https://i.postimg.cc/hPQPLfyp/Screenshot-46.jpg",
  "Natalia": "https://i.postimg.cc/ydN7kd3L/Screenshot-47.jpg",
  "Bernadeta Sri": "https://i.postimg.cc/wjdHDFsd/Screenshot-48.jpg",
  "Rossa Bhedsy": "https://i.postimg.cc/gkbkKGCW/Screenshot-49.jpg",
  "Kristina": "https://i.postimg.cc/jj2sj27M/Screenshot-50.jpg",
};

// ===== DEFINE NAMA LIST =====
const namaList = Object.keys(fotoMap); // Menentukan nama berdasarkan fotoMap

// ===== 312 HARI =====
const startDate = new Date("2025-09-01");
const tanggalList = [];
const monthNames = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
for(let i=0;i<312;i++){
  const d = new Date(startDate);
  d.setDate(startDate.getDate()+i);
  tanggalList.push({day:d.getDate(),month:monthNames[d.getMonth()],fullDate:d.toISOString().slice(0,10)});
}

// ===== HEADER TABEL =====
let headerRow1 = `<tr><th>No</th><th>Nama</th><th colspan="${tanggalList.length}">Tanggal</th><th>Aksi</th></tr>`;
let headerRow2 = `<tr><th></th><th></th>`;
tanggalList.forEach(t=>{ headerRow2 += `<th>${t.day}<br>${t.month}</th>`; });
headerRow2 += `<th></th></tr>`;
document.querySelector("table thead").innerHTML = headerRow1 + headerRow2;

// ===== BODY TABEL =====
const tabel = document.getElementById("tabelAbsensi");
namaList.forEach((nama,i)=>{
  let row = `<tr><td>${i+1}</td><td>${nama}</td>`;
  tanggalList.forEach(t=>{ row += `<td><input type="checkbox" data-nama="${nama}" data-fulldate="${t.fullDate}"></td>`; });
  row += `<td class="aksi" data-nama="${nama}"><span class="text-muted">Belum ada</span></td></tr>`;
  tabel.innerHTML += row;
});

// ===== MODAL INPUT AYAT =====
const modalAyatHTML = `
<div class="modal fade" id="modalAyat">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Ayat Emas</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <textarea id="inputAyat" class="form-control" rows="3" style="resize:vertical"></textarea>
        <div class="mt-2 d-flex justify-content-between">
          <button class="btn btn-warning" id="adminBtn">ğŸ”’ Admin</button>
          <button class="btn btn-primary" id="simpanAyatBtn" disabled>Simpan</button>
        </div>
      </div>
    </div>
  </div>
</div>
`;
document.body.insertAdjacentHTML('beforeend', modalAyatHTML);
const ADMIN_PIN = "312KMA"; // GANTI SESUAI KEINGINAN
let adminUnlocked = false;
document.getElementById("inputAyat").readOnly = true;
document.getElementById("simpanAyatBtn").disabled = true;
adminUnlocked = false;

const modalAyat = new bootstrap.Modal(document.getElementById('modalAyat'));
let currentCheckbox = null;

// ===== CHECKBOX CLICK =====
document.querySelectorAll("input[type=checkbox]").forEach(cb=>{
  cb.addEventListener("click", ()=>{
    currentCheckbox = cb;
    const nama = cb.dataset.nama;
    const date = cb.dataset.fulldate;

    db.ref(`laporan/${date}/${nama}`).once("value", snap=>{
      const data = snap.val();

      // RESET MODE
      adminUnlocked = false;
      document.getElementById("inputAyat").readOnly = false;
      document.getElementById("simpanAyatBtn").disabled = false;

      if(data && data.hadir){
        // ğŸ”’ DATA SUDAH ADA â†’ TERKUNCI
        document.getElementById("inputAyat").value = data.ayat || "";
        document.getElementById("inputAyat").readOnly = true;
        document.getElementById("simpanAyatBtn").disabled = true;
      } else {
        // âœ… DATA BARU â†’ PESERTA BOLEH ISI
        document.getElementById("inputAyat").value = "";
      }

      modalAyat.show();
    });
  });
});

// ===== SIMPAN AYAT =====
document.getElementById("simpanAyatBtn").addEventListener("click", ()=>{
  if(!currentCheckbox) return;

  const nama = currentCheckbox.dataset.nama;
  const date = currentCheckbox.dataset.fulldate;
  const ayat = document.getElementById("inputAyat").value;

  db.ref(`laporan/${date}/${nama}`).once("value", snap=>{
    const data = snap.val();

    // âŒ DATA SUDAH ADA & BUKAN ADMIN
    if(data && data.hadir && !adminUnlocked){
      alert("Ayat sudah disimpan dan tidak dapat diubah âŒ");
      return;
    }

    // âœ… SIMPAN DATA
    db.ref(`laporan/${date}/${nama}`).set({
      hadir: true,
      ayat: ayat
    }).then(()=>{
      currentCheckbox.checked = true;
      modalAyat.hide();
      tampilkanKartuNama();
      loadCheckboxTerakhir();
    });
  });
});


// ===== LOAD DATA TERAKHIR =====
function loadCheckboxTerakhir(){
  db.ref("laporan").once("value",snap=>{
    const data = snap.val();
    if(!data) return;
    document.querySelectorAll("input[type=checkbox]").forEach(cb=>{
      const nama = cb.dataset.nama;
      const date = cb.dataset.fulldate;
      if(data[date] && data[date][nama] && data[date][nama].hadir){
        cb.checked = true;
        const td = document.querySelector(`.aksi[data-nama="${nama}"]`);
        td.innerHTML = `<button class="btn btn-sm btn-primary" onclick="openModalNama('${nama}')">ğ‹ğ¢ğ¡ğšğ­</button>`;
      }
    });
  });
}

// ===== TAMPILKAN CARD (NAMA SAJA) =====
function tampilkanKartuNama(){
  const list = document.getElementById("listMinggu");
  list.innerHTML = "";

  namaList.forEach(nama=>{
    const foto = fotoMap[nama] || "https://i.imgur.com/default.jpg";
    list.innerHTML += `
      <div class="card" onclick="openModalNama('${nama}')">
        <img src="${foto}"
             class="card-img-top"
             loading="lazy"
             style="height:120px; object-fit:cover;">
        <div class="card-body p-2">
          <h6>${nama}</h6>
        </div>
      </div>
    `;
  });
}

// ===== MODAL LAPORAN MINGGUAN =====
function openModalNama(nama){
  const modal = new bootstrap.Modal(document.getElementById("modalLaporan"));
  const isi = document.getElementById("isiModal");
  isi.innerHTML = "";
  db.ref("laporan").once("value", snap => {
    const data = snap.val();
    const mingguList = [];
    for(let i=0; i<312; i+=7){
      mingguList.push(tanggalList.slice(i,i+7));
    }
    mingguList.forEach((minggu,index)=>{
      let hadirTanggal = [];
      minggu.forEach(t=> {
        if (data[t.fullDate] && data[t.fullDate][nama] && data[t.fullDate][nama].hadir) {
          hadirTanggal.push(`<a href="javascript:void(0)" onclick="editAyat('${t.fullDate}','${nama}')">${t.day} ${t.month}</a>`);
        }
      });
      isi.innerHTML += `<tr><td>${index+1}</td><td>Minggu ke ${index+1}</td><td>${hadirTanggal.join(", ") || "-"}</td></tr>`;
    });
  });
  modal.show();
}
// ===== EDIT AYAT DARI LAPORAN MINGGUAN =====
function editAyat(fullDate, nama){
  currentCheckbox = {
    dataset: {
      nama: nama,
      fulldate: fullDate
    }
  };

  db.ref(`laporan/${fullDate}/${nama}/ayat`).once("value", snap=>{
    document.getElementById("inputAyat").value = snap.val() || "";

    // aktifkan tombol simpan
    document.getElementById("simpanAyatBtn").disabled = false;

    modalAyat.show();
  });
}

// ===== HAPUS DATA =====
function hapusNama(nama){
  if(confirm(`Yakin hapus semua data absensi ${nama}?`)){
    db.ref("laporan").once("value", snap=>{
      const data = snap.val();
      if(!data) return;
      Object.keys(data).forEach(tgl=>{
        if(data[tgl] && data[tgl][nama] !== undefined){
          db.ref(`laporan/${tgl}/${nama}`).remove();
        }
      });
      alert(`Data absensi ${nama} berhasil dihapus`);
      loadCheckboxTerakhir();
      tampilkanKartuNama();
    });
  }
}

// ===== INITIALIZE =====
tampilkanKartuNama();
loadCheckboxTerakhir();
document.getElementById("adminBtn").addEventListener("click", ()=>{
  const pin = prompt("Masukkan PIN Admin:");

  if(pin === ADMIN_PIN){
    adminUnlocked = true;
    document.getElementById("inputAyat").readOnly = false;
    document.getElementById("simpanAyatBtn").disabled = false;
    alert("Mode Admin Aktif âœ…");
  } else {
    alert("PIN salah âŒ");
  }
});

</script>
</body>
</html>
